<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="UTF-8">
	<title>restore/Create task</title>
	<style>
* { outline: 1px solid red; }
th.row-header{text-align: left}
	</style>
	<script src="utils.js"></script>
	<script src="make_form.js"></script>
	<script src="serialize_form.js"></script>
	<script>
let record_description = JSON.parse("{\
	\"description\": {\
		\"display\": \"block\",\
		\"type\": {\
			\"category\":\"atom\",\
			\"name\": \"string\",\
			\"input_size\": \"long\"\
		}\
	},\
	\"name\": {\
		\"display\": \"inline\",\
		\"type\": {\
			\"category\":\"atom\",\
			\"name\": \"string\",\
			\"input_size\": \"short\"\
		}\
	},\
	\"length\": {\
		\"display\": \"inline\",\
		\"type\": {\
			\"category\":\"atom\",\
			\"name\": \"number\"\
		}\
	},\
	\"home_world\": {\
		\"display\": \"block\",\
		\"type\": {\
			\"category\":\"composite\",\
			\"name\": \"planet\"\
		}\
	}\
}");

let types = JSON.parse("{\
	\"composite\": {\
		\"planet\": {\
			\"fields\": {\
				\"name\": {\
					\"display\": \"inline\",\
					\"type\": {\
						\"category\":\"atom\",\
						\"name\": \"string\",\
						\"input_size\": \"short\"\
					}\
				},\
				\"description\": {\
					\"display\": \"block\",\
					\"type\": {\
						\"category\":\"atom\",\
						\"name\": \"string\",\
						\"input_size\": \"long\"\
					}\
				},\
				\"mass\": {\
					\"display\": \"inline\",\
					\"type\": {\
						\"category\":\"atom\",\
						\"name\": \"number\"\
					}\
				},\
				\"radius\": {\
					\"display\": \"inline\",\
					\"type\": {\
						\"category\":\"atom\",\
						\"name\": \"number\"\
					}\
				},\
				\"type\": {\
					\"display\": \"inline\",\
					\"type\": {\
						\"name\": \"planet_type\",\
						\"category\": \"enum\"\
					}\
				},\
				\"has_water\": {\
					\"display\": \"inline\",\
					\"type\": {\
						\"name\": \"boolean\",\
						\"category\": \"atom\"\
					}\
				}\
			}\
		}\
	},\
	\"enum\": {\
		\"planet_type\": {\
			\"allowed_values\": {\
				\"rocky\" : {\
					\"display_name\": \"Rocky\"\
				},\
				\"gas_giant\" : {\
					\"display_name\": \"Gas giant\"\
				}\
			}\
		}\
	}\
}")
</script>

<script>
function submit_form(event, doc, subform)
{
	event.preventDefault();
	let output_object = {}
	serialize_form(subform, output_object);

	let message = JSON.stringify(output_object);
	let req = new XMLHttpRequest();
	let task_name = encodeURIComponent(doc.getElementById("task_name").value);
	console.log(task_name)
	req.open("POST", "/tasks", true);
	req.responseType = "json";
	req.setRequestHeader("Accept", "application/json");
	req.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
	req.onreadystatechange = function() {
		if(this.readyState == 4)
		{
			console.log(this.response);
		}
	};
	req.send(message);

	return false;
}
</script>

	</head>
	<body onload="generate_form(document, paraminputs, record_description, types)">
	<form onsubmit="return submit_form(event, document, paraminputs);">
		<h1>Create task</h1>
		<table>
			<tr>
				<th class="row-header">name</th>
				<td field-name="name" field-type-name="string" field-type-category="atom">
					<input id="task_name">
				</td>
			</tr>
		</table>

		<section id="paraminputs">
			<h1>Parameters</h1>
		</section>
		<nav id="formactions">
			<ul>
				<li><input type="submit" value="Submit"></li>
			</ul>
		</nav>
	</form>
	</body>
</html>


