<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="UTF-8">
	<title>restore/Mainpage</title>
	<style>
* { outline: 1px solid red; }
th.row-header{text-align: left}
	</style>
	<script src="../public/utils.js"></script>
	<script src="../public/check_session_cookie.js"></script>
	<script src="make_task_list.js"></script>
	<script>

let pending_task_list = send_request("/tasks");

let task_actions = {
	get_result : async function(task_name, task_uri_name) {
		console.log("get_result");
	},
	resume: async function(task_name, task_uri_name) {
		console.log("resume");
	},
	suspend: async function(task_name, task_uri_name) {
		console.log("suspend");
	},
	delete: async function(task_name, task_uri_name) {
		let response = await send_request("/tasks/" + task_uri_name, "DELETE");
		if(!response.succeeded)
		{
			alert("The server returned HTTP status " +
				response.message.http_status.toString() +
				" with message " + response.message.error_message);
			return;
		}

		await refresh_tasklist();
	},
	copy: async function(task_name, task_uri_name) {
		console.log("copy");
	}
};

window.onload = async function() {
	await redirect_if_not_logged_in(location, document);
	let get_task_list_result = await pending_task_list;
	fill_tasklist(get_task_list_result, document, document.getElementById("tasklist"), task_actions);
}

async function refresh_tasklist()
{
	await redirect_if_not_logged_in(location, document);
	let get_task_list_result = await send_request("/tasks");
	let tasklist = document.getElementById("tasklist");
	tasklist.replaceChildren();
	fill_tasklist(get_task_list_result, document, tasklist, task_actions);
}

	</script>
	</head>
	<body>
		<header><h1>Mainpage</h1></header>
		<main>
			<section>
				<h1>Tasks</h1>
				<nav id="formactions">
					<ul>
						<li><input type="button" value="Refresh" onclick="refresh_tasklist()"></li>
						<li><input type="button" value="Create new task" onclick="location.href='create_task.html'"></li>
					</ul>
				</nav>
				<table id="tasklist">
				</table>
			</section>
		</main>
	</body>
</html>


