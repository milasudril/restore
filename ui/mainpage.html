<!DOCTYPE html>
<html lang="en">
	<head>
	<meta charset="UTF-8">
	<title>restore/Mainpage</title>
	<style>
* { outline: 1px solid red; }
th.row-header{text-align: left}
	</style>

	<script>
let pending_task_list = fetch("/tasks", {
	headers: {
		"Accept": "application/json"
	}
}).then(function(res) {
	return {succeeded: res.ok, pending_message: res.json()};
}).then(async function(data){
	let message = await data.pending_message;
	return {succeeded: data.succeeded, message: message};
});

function fill_tasklist(response, element_factory, output_container)
{
	if(!response.succeeded)
	{
		let caption = element_factory.createElement("caption");
		caption.setAttribute("class", "error_message");
		let caption_content = element_factory.createTextNode("There are tasks to display: " + response.message.error_message);
		caption.appendChild(caption_content);
		output_container.appendChild(caption);
		return;
	}

	if(Object.keys(response).length == 0)
	{
		let caption = element_factory.createElement("caption");
		caption.setAttribute("class", "error_message");
		let caption_content = element_factory.createTextNode("There are no tasks to display");
		caption.appendChild(caption_content);
		output_container.appendChild(caption);
		return;
	}

	for(let task in response.message)
	{
		let row = element_factory.createElement("tr");

		let taskname_cell = element_factory.createElement("td");
		let taskname_element = element_factor.createTextNode(task);
		taskname_cell.appendChild(taskname_element);
		row.appendChild(taskname_cell);

		let taskstatus_cell = element_factory.createElement("td");
		let taskstatus_element = element_factor.createTextNode(response.message[task].status);
		taskstatus_cell.appendChild(taskstatus_element);
		row.appendChild(taskstatus_cell);

		output_container.appendChild(row);
	}
}

window.onload = async function() {
	let get_task_list_result = await pending_task_list;
	fill_tasklist(get_task_list_result, document, document.getElementById("tasklist"));
}
	</script>
	</head>
	<body>
	<header><h1>Mainpage</h1></header>
	<main>
		<section><h1>Tasks</h1></section>
		<table id="tasklist">
		</table>
	</main>
	</body>
</html>


